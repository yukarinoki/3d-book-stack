# 3D Book Stack - 要件定義書

## 1. プロジェクト概要

### 1.1 目的

本アプリケーションは以下の2つの主要目的を持つ：

1. **読書記録管理**: ユーザーが読んだ本または購入した本を記録・管理する
2. **3Dビジュアライゼーション**: 記録した本を3Dモデルとして生成し、物理シミュレーションを用いて視覚的に積み上げて表示する

### 1.2 ビジョン

読書体験をデジタル空間で物理的に表現し、読書の達成感を視覚化することで、読書のモチベーション向上と記録の楽しさを提供する。

## 2. 機能要件

### 2.1 本の3Dモデル作成機能

#### 2.1.1 テクスチャ取得

- **写真撮影インターフェース**
  - ユーザーが本の写真を撮影/アップロード
  - 必要な面：表紙、背表紙、裏表紙、本の上部（天）
  - 下部（地）は上部と同じテクスチャを使用
  - 実装技術：WebカメラAPI、File API
- **画像編集機能**
  - アップロードした画像から必要な部分を切り取るツール
  - プレビュー機能
  - 調整機能（回転、スケール、位置調整）
  - 実装技術：Canvas API、react-image-crop

# テクスチャ確認機能 要件定義書

## 概要

選択した本に設定されている全てのテクスチャ画像を一覧で確認できるモーダル機能を実装する。

## 機能要件

### 1. ボタン配置と動作

- Levaコントロールパネルの「設定」セクションに「テクスチャ確認」ボタンを配置
- 既存の「画像機能」ボタンを「テクスチャ確認」に名称変更

### 2. 表示条件

- **本を1冊選択している場合**：テクスチャ確認モーダルを表示
- **本を選択していない場合**：「本を選択してください」というアラートを表示
- **複数の本を選択している場合**：「1冊のみ選択してください」というアラートを表示

### 3. モーダル仕様

#### 3.1 基本レイアウト

- フルスクリーンオーバーレイ（半透明背景）
- 中央配置のモーダルウィンドウ
- モーダル外クリックまたは閉じるボタンで閉じる

#### 3.2 表示内容

- **ヘッダー部**
  - タイトル：「テクスチャ確認 - [本のタイトル]」
  - 閉じるボタン（×アイコン）

- **本体部**
  - 各面のテクスチャをグリッドレイアウトで表示
  - 表示する面：
    - 表紙（front）
    - 裏表紙（back）
    - 背表紙（spine）
    - 天（top）
    - 地（bottom）
    - 小口（fore-edge）
  
#### 3.3 各テクスチャの表示仕様

- **画像が設定されている場合**：
  - サムネイル画像を表示（クリックで拡大表示）
  - 面の名称をラベル表示
  - 画像サイズは統一（アスペクト比は維持）
  
- **画像が未設定の場合**：
  - プレースホルダー表示（グレーの背景に「未設定」テキスト）
  - 面の名称をラベル表示

#### 3.4 画像拡大表示

- サムネイルクリックで拡大モーダルを表示
- 拡大モーダル内でズーム・パン操作可能
- ESCキーまたは閉じるボタンで拡大モーダルを閉じる

### 4. UI/UXデザイン

- レスポンシブデザイン対応
- スムーズなアニメーション（フェードイン/アウト）
- キーボード操作対応（ESCで閉じる、矢印キーで画像切り替え）

### 5. 技術仕様

#### 5.1 コンポーネント構成

```
TextureViewModal/
├── index.tsx          // メインコンポーネント
├── TextureGrid.tsx    // テクスチャグリッド表示
├── TextureItem.tsx    // 個別テクスチャ表示
└── ImageViewer.tsx    // 拡大表示コンポーネント
```

#### 5.2 状態管理

- 表示/非表示の状態はApp.tsxで管理
- 拡大表示の状態はモーダル内部で管理

#### 5.3 スタイリング

- Tailwind CSSを使用
- グリッドレイアウトはCSS Gridで実装

### 6. エラーハンドリング

- 画像読み込みエラー時は代替画像を表示
- ネットワークエラー時の再読み込みボタン

### 7. パフォーマンス考慮

- 画像の遅延読み込み（Lazy Loading）
- サムネイルは適切なサイズに最適化
- モーダル非表示時はDOMから削除

### 8. アクセシビリティ

- 適切なaria-label設定
- フォーカストラップ実装
- スクリーンリーダー対応

## 実装優先順位

1. 基本的なモーダル表示機能
2. テクスチャグリッド表示
3. 画像拡大表示機能
4. キーボード操作対応
5. アニメーション追加

#### 2.1.2 本の形状選択

- **プリセット形状**
  - 文庫本
  - ハードカバー
  - ソフトカバー
  - 漫画
- **カスタマイズ可能なパラメータ**
  - 寸法（高さ、幅、厚さ）- 単位：mm
  - 背表紙の丸み
  - カバーの厚さ（ハードカバーの場合）
  - ページの質感設定

#### 2.1.3 3Dモデル生成・管理

- **プレビュー機能**
  - リアルタイムで3Dモデルをプレビュー
  - 360度回転して確認可能
- **保存機能**
  - ローカルダウンロード（GLTFまたはOBJ形式）
  - クラウド保存（デプロイ段階でAWS S3に保存）
  - メタデータの保存（タイトル、著者、ISBN、読了日、購入日等）

### 2.2 本の記録管理機能

#### 2.2.1 書籍情報登録

- **基本情報**
  - タイトル
  - 著者
  - 出版社
  - ISBN
  - カテゴリ/ジャンル
- **読書状態**
  - 購入日
  - 読了日
  - 読書ステータス（未読、読書中、読了）
  - 評価（5段階評価）
  - メモ/感想

#### 2.2.2 検索・フィルタリング機能

- **時間軸での検索**
  - 今週読んだ本
  - 今月読んだ本
  - 今年読んだ本
  - 今月購入した本
- **その他の検索条件**
  - カテゴリ別
  - 評価別
  - 読書ステータス別
  - キーワード検索（タイトル、著者）

### 2.3 3Dビジュアライゼーション機能

#### 2.3.1 物理スタックモード

- **本の落下アニメーション**
  - 検索条件に応じた本が上から落下
  - 物理エンジン（Rapier）による自然な積み上がり
- **インタラクション**
  - マウスオーバーで本の情報表示
  - ドラッグ&ドロップで本の位置調整（@use-gesture/react）
  - クリックで詳細情報表示
- **物理シミュレーション制御**
  - 重力のON/OFF
  - 跳ね上げボタン（全ての本に上向き加速度を付与）
  - モバイル：Device Orientation APIによる加速度センサー操作
  - PC：マウス/キーボードによる操作

#### 2.3.2 表示モード切替

- **スタックモード**: 本を物理的に積み上げて表示
- **表紙並べモード**: グリッド状に表紙を並べて表示
- **背表紙並べモード（本棚モード）**: 本棚のように背表紙を並べて表示

#### 2.3.3 カメラ制御

- 自由視点カメラ
- プリセットビュー（正面、側面、上面、斜め）
- ズームイン/アウト
- オートローテーション機能

### 2.4 共有・埋め込み機能

#### 2.4.1 共有リンク生成

- 特定の本のコレクションを共有するためのユニークURL生成
- 共有設定（公開/限定公開）
- 有効期限設定

#### 2.4.2 埋め込み機能

- iframeでの埋め込みコード生成
- カスタマイズ可能な埋め込みオプション
  - サイズ設定
  - 表示モード指定
  - インタラクションの有効/無効

## 3. 非機能要件

### 3.1 パフォーマンス

- **レンダリング性能**
  - Phase 1 (MVP): 最大20冊の本を同時に表示可能
  - Phase 2: 最大50冊の本を同時に表示可能
  - Phase 4: 最大100冊の本を同時に表示可能
  - 60FPSでのスムーズなアニメーション
  - LOD（Level of Detail）による最適化
- **読み込み時間**
  - 初期ロード: 3秒以内
  - 3Dモデル生成: 5秒以内

### 3.2 ユーザビリティ

- **レスポンシブデザイン**
  - デスクトップ、タブレット、モバイルに対応
  - タッチ操作とマウス操作の両方をサポート
- **アクセシビリティ**
  - キーボードナビゲーション対応
  - スクリーンリーダー対応（基本機能）

### 3.3 セキュリティ

- **データ保護**
  - HTTPSによる通信の暗号化
  - ユーザーデータの適切な保護
- **アクセス制御**
  - ユーザー認証機能
  - プライベート/パブリック設定

### 3.4 拡張性

- **モジュラー設計**
  - 機能の追加・削除が容易な設計
  - プラグインシステムの考慮
- **API設計**
  - RESTful APIまたはGraphQL
  - 将来的な外部連携を考慮
- **プログレッシブ機能追加**
  - オフラインファースト設計
  - PWA（Progressive Web App）対応
  - Service Workerによるキャッシュ管理

## 4. 技術仕様

### 4.1 フロントエンド

- **フレームワーク**: React + TypeScript
- **3Dレンダリング**:
  - Three.js
  - React Three Fiber
  - Drei（Three.jsユーティリティ）
- **物理エンジン**: Rapier（React Three Rapier）
- **UI制御**: Leva（ランタイムGUIコントロール）
- **ビルドツール**: Vite
- **状態管理**: Zustand（推奨）
- **スタイリング**: Tailwind CSS + CSS Modules

### 4.2 バックエンド（デプロイ段階）

- **API**: Node.js + Express / FastAPI
- **データベース**: PostgreSQL
- **ファイルストレージ**: AWS S3
- **認証**: JWT / OAuth2

### 4.3 インフラストラクチャ

- **ホスティング**: Vercel / AWS
- **CDN**: CloudFront
- **CI/CD**: GitHub Actions

## 5. 開発フェーズ

### Phase 1: MVP（最小実行可能製品）

1. 基本的な3Dスタック表示機能
   - プリセット形状（文庫本、ハードカバー）の本のみ
   - 単色またはプリセットテクスチャ
   - 最大20冊の表示
2. シンプルな物理シミュレーション
   - 落下アニメーション
   - 基本的な積み上げ
3. ローカルストレージでのデータ保存
   - 本の基本情報（タイトル、著者、サイズ）
   - 読書ステータス

### Phase 2: 機能拡張

1. 複数の表示モード実装
   - 表紙並べモード
   - 背表紙並べモード（本棚モード）
2. 高度なインタラクション機能
   - ドラッグ&ドロップ（@use-gesture/react）
   - マウスオーバー情報表示
   - 最大50冊の表示対応
3. 画像編集インターフェース
   - 写真アップロード機能
   - 基本的な切り取り・調整ツール
   - Canvas APIを使用した画像処理
4. IndexedDBによる大容量ローカルストレージ

### Phase 3: クラウド対応

1. バックエンドAPI構築
   - Node.js + Express または FastAPI
   - PostgreSQLデータベース
2. AWS S3連携
   - 3Dモデルファイルの保存
   - テクスチャ画像の保存
3. ユーザー認証・共有機能
   - JWT/OAuth2認証
   - 共有リンク生成
4. モバイルセンサー対応
   - Device Orientation APIによる加速度センサー連携

### Phase 4: 最適化・公開

1. パフォーマンス最適化
   - 最大100冊の表示対応
   - WebWorkerによる処理の並列化
   - テクスチャ圧縮とLOD実装
2. 埋め込み機能
   - iframeコード生成
   - カスタマイズ可能なウィジェット
3. モバイル最適化
   - タッチジェスチャーの完全サポート
   - レスポンシブ3Dビューポート
4. PWA対応
   - オフライン動作
   - アプリライクな体験

## 6. 制約事項

- ブラウザの3D描画性能に依存
- モバイルデバイスでは表示可能な本の数に制限
- 大きな画像ファイルのアップロードには時間がかかる可能性

## 7. 将来的な拡張案

- AI による本の自動認識（カメラで撮影するだけで書籍情報を取得）
- ソーシャル機能（他のユーザーの本棚を見る）
- 読書統計・分析機能
- VR/AR対応
- 電子書籍との連携
