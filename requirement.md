# 3D Book Stack アプリケーション要件定義書

## 概要
3D Book Stackは、本を3次元空間で視覚化し、管理するためのWebアプリケーションです。本の表紙や背表紙のテクスチャマッピング、物理演算、複数の表示モードをサポートしています。

## 本データ編集機能 要件定義

### 1. データモデル拡張

#### 1.1 追加フィールド
本（Book）エンティティに以下のフィールドを追加：

- **purchaseDate** (購入日)
  - 型: `string | null` (ISO 8601形式)
  - 必須: いいえ
  - 説明: 本を購入した日付
  - 例: "2024-01-15"

- **finishDate** (終読日)
  - 型: `string | null` (ISO 8601形式)
  - 必須: いいえ
  - 説明: 本を読み終えた日付
  - 例: "2024-02-20"
  - 制約: purchaseDateより前の日付は設定不可

### 2. 本データ編集画面

#### 2.1 画面概要
- **画面名**: 本データ管理画面（Book Data Manager）
- **パス**: `/books/manage`
- **アクセス方法**: 
  - ヘッダーナビゲーションに「データ管理」ボタンを追加
  - キーボードショートカット: Ctrl/Cmd + M

#### 2.2 画面構成

##### 2.2.1 ヘッダー部
- タイトル: "本データ管理"
- アクション:
  - 「新規追加」ボタン
  - 「インポート」ボタン（CSV/JSON）
  - 「エクスポート」ボタン（CSV/JSON）
  - 「3D表示に戻る」ボタン

##### 2.2.2 フィルター・検索部
- テキスト検索（タイトル、著者で部分一致検索）
- 日付範囲フィルター（購入日、終読日）
- 読了状態フィルター（未読/読了中/読了）
- 表示件数選択（10/25/50/100件）

##### 2.2.3 データテーブル部

**カラム構成**:
1. **選択チェックボックス** - バルク操作用
2. **タイトル** - 編集可、必須、最大200文字
3. **著者** - 編集可、必須、最大100文字
4. **サイズ** - 表示のみ（幅×高さ×厚さmm）
5. **購入日** - 編集可、日付ピッカー
6. **終読日** - 編集可、日付ピッカー
7. **読了状態** - 自動計算（終読日の有無で判定）
8. **アクション** - 編集/削除ボタン

**機能要件**:
- ソート: 各カラムでソート可能（タイトル、著者、購入日、終読日）
- ページネーション: 大量データ対応
- インライン編集: セルダブルクリックで編集モード
- 行選択: 単一選択、複数選択（Shift/Ctrl+クリック）

#### 2.3 編集機能

##### 2.3.1 インライン編集
- ダブルクリックでセルを編集モードに
- Enter: 保存して次のセルへ
- Tab: 保存して右のセルへ
- Esc: キャンセル
- 自動保存（フォーカスアウト時）

##### 2.3.2 詳細編集モーダル
- 編集ボタンクリックで表示
- 全フィールドの編集が可能
- 3Dプレビュー表示
- テクスチャの確認・変更

##### 2.3.3 バルク編集
- 複数選択時に「一括編集」ボタン表示
- 編集可能項目:
  - 購入日の一括設定
  - 終読日の一括設定
  - 削除

#### 2.4 データ検証

##### 2.4.1 バリデーションルール
- **タイトル**: 必須、1-200文字
- **著者**: 必須、1-100文字
- **寸法**: 正の数値、1-9999mm
- **購入日**: 
  - 未来の日付は警告表示（確認後は許可）
  - 1900年以前は入力不可
- **終読日**:
  - 購入日より前は入力不可
  - 未来の日付は入力不可

##### 2.4.2 エラー表示
- フィールドレベル: 赤枠表示 + エラーメッセージ
- 保存時: トースト通知でエラー内容表示
- 一覧表示: エラーのある行をハイライト

#### 2.5 データ永続化

##### 2.5.1 保存タイミング
- インライン編集: フォーカスアウト時に自動保存
- モーダル編集: 「保存」ボタンクリック時
- バルク編集: 確認ダイアログ後に保存

##### 2.5.2 競合解決
- 楽観的ロック: 編集開始時のデータと保存時のデータを比較
- 競合検出時: 差分表示ダイアログで解決方法を選択

#### 2.6 インポート/エクスポート

##### 2.6.1 対応フォーマット
- CSV: 基本情報のみ（テクスチャURLは除外）
- JSON: 全データ（テクスチャURL含む）

##### 2.6.2 インポート時の処理
- データ検証
- 重複チェック（タイトル+著者）
- エラー行のスキップオプション
- プレビュー表示

#### 2.7 パフォーマンス要件
- 初期表示: 1000件まで1秒以内
- 検索・フィルター: 即座に反映（デバウンス300ms）
- 保存処理: 単一更新は500ms以内

#### 2.8 アクセシビリティ要件
- キーボードナビゲーション完全対応
- スクリーンリーダー対応（ARIA属性）
- ハイコントラストモード対応
- フォーカス管理

#### 2.9 エラーハンドリング
- ネットワークエラー: 自動リトライ（3回まで）
- 保存失敗: ローカルストレージに一時保存
- データ破損: 復旧モードの提供

### 3. 実装上の注意事項

#### 3.1 状態管理
- Zustandストアの拡張
- 編集中データの一時保存
- Undo/Redo機能の実装

#### 3.2 セキュリティ
- XSS対策: 入力値のサニタイズ
- CSVインジェクション対策
- ファイルサイズ制限（10MB）

#### 3.3 テスト要件
- 単体テスト: バリデーションロジック
- 統合テスト: データ保存・読み込み
- E2Eテスト: 主要ユーザーフロー

### 4. 将来の拡張予定
- タグ機能
- 読書メモ機能
- 統計ダッシュボード
- 外部API連携（書籍情報取得）