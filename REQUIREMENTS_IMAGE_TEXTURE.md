# 画像アップロード・トリミング・テクスチャ適用機能　要件定義書

## 概要
ユーザーが3D本のテクスチャをカスタマイズできるよう、画像のアップロード、プレビュー、トリミング、適用機能を実装する。

## 機能要件

### 1. 画像アップロード機能
- **対応フォーマット**: JPG, JPEG, PNG, GIF, WebP
- **ファイルサイズ制限**: 最大10MB
- **アップロード方法**: 
  - ファイル選択ダイアログ
  - ドラッグ&ドロップ

### 2. 画像プレビュー・編集モーダル
- **モーダルUI**: 
  - 本を選択時に「テクスチャを変更」ボタンを表示
  - ボタンクリックで画像編集モーダルを開く
  - モーダル内で画像のアップロード・プレビュー・トリミングを行う

### 3. トリミング機能
- **インタラクティブなトリミング**:
  - マウスドラッグによる選択範囲の指定
  - アスペクト比の固定オプション（本の表紙に合わせる）
  - リアルタイムプレビュー
- **プリセット**:
  - 表紙全体
  - 表表紙のみ
  - 背表紙のみ
  - カスタム領域

### 4. テクスチャ適用機能
- **適用対象**:
  - 表表紙
  - 裏表紙
  - 背表紙
  - 全体
- **適用方法**:
  - トリミング完了後、「適用」ボタンで3D本にテクスチャを反映
  - リアルタイムで3Dビューに反映

### 5. UI/UXデザイン
- **モーダルレイアウト**:
  ```
  +------------------------------------------+
  |  画像テクスチャ編集                        |
  +------------------------------------------+
  | [アップロードエリア]                       |
  |  ドラッグ&ドロップまたはクリックして選択     |
  +------------------------------------------+
  | [画像プレビューエリア]                     |
  |  - トリミング可能な画像表示                |
  |  - トリミング枠の表示                      |
  +------------------------------------------+
  | 適用箇所: [▼表紙全体]                     |
  | アスペクト比: [□固定]                     |
  +------------------------------------------+
  | [キャンセル]              [適用]          |
  +------------------------------------------+
  ```

## 技術仕様

### 使用ライブラリ
- **画像トリミング**: react-image-crop または react-cropper
- **画像処理**: Canvas API
- **Three.js テクスチャ**: THREE.TextureLoader

### データフロー
1. ユーザーが画像をアップロード
2. 画像をBase64またはObjectURLに変換
3. プレビュー表示
4. トリミング情報を保存
5. Canvas APIでトリミング実行
6. Three.jsのTextureLoaderでテクスチャとして読み込み
7. 選択された本のマテリアルに適用

### エラーハンドリング
- ファイル形式が非対応の場合のエラーメッセージ
- ファイルサイズ超過時のエラーメッセージ
- 画像読み込み失敗時のフォールバック表示

## 実装優先順位
1. 画像アップロード基本機能
2. プレビュー表示
3. テクスチャ適用（トリミングなし）
4. トリミング機能の追加
5. UI/UXの改善

## 現在の問題点
- placeholder.com への不要な外部リクエストが発生している
- これはダミーURLがハードコードされているため発生
- ローカルの画像アップロード機能に完全に置き換える必要がある